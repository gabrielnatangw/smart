import { PrismaClient } from '@prisma/client';

const prisma = new PrismaClient();

async function seedHelpCenter() {
  console.log('üå± Iniciando seed do Help Center...');

  try {
    // Buscar aplica√ß√µes existentes (assumindo que existem)
    const applications = await prisma.application.findMany();

    if (applications.length === 0) {
      console.log(
        '‚ö†Ô∏è  Nenhuma aplica√ß√£o encontrada. Criando aplica√ß√µes de exemplo...'
      );

      // Criar aplica√ß√µes de exemplo
      const dTraceApp = await prisma.application.create({
        data: {
          name: 'd-trace',
          displayName: 'D-Trace',
          description: 'Sistema de rastreamento de dados',
          isActive: true,
        },
      });

      const pTraceApp = await prisma.application.create({
        data: {
          name: 'p-trace',
          displayName: 'P-Trace',
          description: 'Sistema de rastreamento de produ√ß√£o',
          isActive: true,
        },
      });

      const eTraceApp = await prisma.application.create({
        data: {
          name: 'e-trace',
          displayName: 'E-Trace',
          description: 'Sistema de rastreamento de energia',
          isActive: true,
        },
      });

      const mTraceApp = await prisma.application.create({
        data: {
          name: 'm-trace',
          displayName: 'M-Trace',
          description: 'Sistema de rastreamento de manuten√ß√£o',
          isActive: true,
        },
      });

      applications.push(dTraceApp, pTraceApp, eTraceApp, mTraceApp);
    }

    // 1. Criar tema de M√°quinas
    const machineTheme = await prisma.helpCenterTheme.create({
      data: {
        title: 'Gerenciamento de M√°quinas',
        description: 'Aprenda a configurar e gerenciar m√°quinas no sistema',
        icon_name: 'cog',
        color: '#3B82F6',
        sort_order: 1,
        is_active: true,
      },
    });

    // 2. Criar tema de M√≥dulos
    const moduleTheme = await prisma.helpCenterTheme.create({
      data: {
        title: 'Configura√ß√£o de M√≥dulos',
        description: 'Configure e gerencie m√≥dulos de sensores',
        icon_name: 'cpu',
        color: '#10B981',
        sort_order: 2,
        is_active: true,
      },
    });

    // 3. Criar tema de Sensores
    const sensorTheme = await prisma.helpCenterTheme.create({
      data: {
        title: 'Sensores e Monitoramento',
        description: 'Configure sensores e monitore dados em tempo real',
        icon_name: 'activity',
        color: '#F59E0B',
        sort_order: 3,
        is_active: true,
      },
    });

    // 4. Criar tema de Relat√≥rios
    const reportTheme = await prisma.helpCenterTheme.create({
      data: {
        title: 'Relat√≥rios e Analytics',
        description: 'Gere relat√≥rios e analise dados do sistema',
        icon_name: 'bar-chart-3',
        color: '#8B5CF6',
        sort_order: 4,
        is_active: true,
      },
    });

    // 5. Criar tema de Dashboard
    const dashboardTheme = await prisma.helpCenterTheme.create({
      data: {
        title: 'Dashboard e Visualiza√ß√µes',
        description: 'Configure dashboards e visualiza√ß√µes personalizadas',
        icon_name: 'monitor',
        color: '#EF4444',
        sort_order: 5,
        is_active: true,
      },
    });

    // Associar temas √†s aplica√ß√µes
    for (const app of applications) {
      await prisma.helpCenterThemeApplication.createMany({
        data: [
          {
            theme_id: machineTheme.theme_id,
            application_id: app.application_id,
          },
          {
            theme_id: moduleTheme.theme_id,
            application_id: app.application_id,
          },
          {
            theme_id: sensorTheme.theme_id,
            application_id: app.application_id,
          },
          {
            theme_id: reportTheme.theme_id,
            application_id: app.application_id,
          },
          {
            theme_id: dashboardTheme.theme_id,
            application_id: app.application_id,
          },
        ],
      });
    }

    // 6. Criar v√≠deos para cada tema usando o mesmo link do YouTube
    const videoData = [
      // V√≠deos de M√°quinas
      {
        title: 'Como Adicionar uma Nova M√°quina',
        description:
          'Tutorial completo para adicionar e configurar uma nova m√°quina no sistema',
        theme_id: machineTheme.theme_id,
        sort_order: 1,
        is_featured: true,
      },
      {
        title: 'Configura√ß√£o de Par√¢metros da M√°quina',
        description:
          'Aprenda a configurar par√¢metros essenciais como performance m√°xima e velocidade',
        theme_id: machineTheme.theme_id,
        sort_order: 2,
        is_featured: false,
      },
      {
        title: 'Associando M√°quinas a Setores',
        description: 'Como organizar m√°quinas por setores operacionais',
        theme_id: machineTheme.theme_id,
        sort_order: 3,
        is_featured: false,
      },

      // V√≠deos de M√≥dulos
      {
        title: 'Instala√ß√£o de M√≥dulo de Sensores',
        description:
          'Passo a passo para instalar e configurar um novo m√≥dulo de sensores',
        theme_id: moduleTheme.theme_id,
        sort_order: 1,
        is_featured: true,
      },
      {
        title: 'Configura√ß√£o de Localiza√ß√£o do M√≥dulo',
        description: 'Defina pa√≠s, cidade, setor e planta do m√≥dulo',
        theme_id: moduleTheme.theme_id,
        sort_order: 2,
        is_featured: false,
      },
      {
        title: 'Associando M√≥dulo √† M√°quina',
        description: 'Como vincular um m√≥dulo a uma m√°quina espec√≠fica',
        theme_id: moduleTheme.theme_id,
        sort_order: 3,
        is_featured: false,
      },

      // V√≠deos de Sensores
      {
        title: 'Configura√ß√£o de Sensor Anal√≥gico',
        description:
          'Configure sensores anal√≥gicos com escalas, alarmes e calibra√ß√£o',
        theme_id: sensorTheme.theme_id,
        sort_order: 1,
        is_featured: true,
      },
      {
        title: 'Configura√ß√£o de Sensor Digital',
        description: 'Configure sensores digitais para contadores e frequ√™ncia',
        theme_id: sensorTheme.theme_id,
        sort_order: 2,
        is_featured: false,
      },
      {
        title: 'Monitoramento em Tempo Real',
        description: 'Visualize dados dos sensores em tempo real no dashboard',
        theme_id: sensorTheme.theme_id,
        sort_order: 3,
        is_featured: false,
      },
      {
        title: 'Configura√ß√£o de Alarmes',
        description: 'Configure alarmes e notifica√ß√µes para os sensores',
        theme_id: sensorTheme.theme_id,
        sort_order: 4,
        is_featured: false,
      },

      // V√≠deos de Relat√≥rios
      {
        title: 'Gerando Relat√≥rio de Produ√ß√£o',
        description: 'Crie relat√≥rios detalhados de produ√ß√£o e performance',
        theme_id: reportTheme.theme_id,
        sort_order: 1,
        is_featured: true,
      },
      {
        title: 'An√°lise de Dados Hist√≥ricos',
        description: 'Analise tend√™ncias e padr√µes nos dados hist√≥ricos',
        theme_id: reportTheme.theme_id,
        sort_order: 2,
        is_featured: false,
      },
      {
        title: 'Exporta√ß√£o de Relat√≥rios',
        description:
          'Exporte relat√≥rios em diferentes formatos (PDF, Excel, CSV)',
        theme_id: reportTheme.theme_id,
        sort_order: 3,
        is_featured: false,
      },

      // V√≠deos de Dashboard
      {
        title: 'Criando Dashboard Personalizado',
        description: 'Crie dashboards personalizados com gr√°ficos e m√©tricas',
        theme_id: dashboardTheme.theme_id,
        sort_order: 1,
        is_featured: true,
      },
      {
        title: 'Configura√ß√£o de Gr√°ficos',
        description:
          'Configure diferentes tipos de gr√°ficos (linha, barra, gauge)',
        theme_id: dashboardTheme.theme_id,
        sort_order: 2,
        is_featured: false,
      },
      {
        title: 'Compartilhamento de Dashboards',
        description: 'Compartilhe dashboards com outros usu√°rios da equipe',
        theme_id: dashboardTheme.theme_id,
        sort_order: 3,
        is_featured: false,
      },
    ];

    // Criar todos os v√≠deos
    for (const video of videoData) {
      const createdVideo = await prisma.helpCenterVideo.create({
        data: {
          title: video.title,
          description: video.description,
          video_platform: 'YOUTUBE',
          external_video_id: '4bJFzyGKpA0',
          external_url: 'https://www.youtube.com/watch?v=4bJFzyGKpA0',
          thumbnail_url:
            'https://img.youtube.com/vi/4bJFzyGKpA0/maxresdefault.jpg',
          duration: 300, // 5 minutos
          sort_order: video.sort_order,
          is_active: true,
          is_featured: video.is_featured,
          theme_id: video.theme_id,
        },
      });

      // Associar v√≠deo a todas as aplica√ß√µes
      for (const app of applications) {
        await prisma.helpCenterVideoApplication.create({
          data: {
            video_id: createdVideo.video_id,
            application_id: app.application_id,
          },
        });
      }
    }

    // 7. Criar algumas buscas de exemplo
    const searchTerms = [
      'configurar sensor',
      'adicionar m√°quina',
      'criar dashboard',
      'gerar relat√≥rio',
      'configurar m√≥dulo',
      'alarme sensor',
      'dados tempo real',
      'exportar dados',
    ];

    for (const term of searchTerms) {
      await prisma.helpCenterSearch.create({
        data: {
          search_term: term,
          results_count: Math.floor(Math.random() * 10) + 1,
        },
      });
    }

    console.log('‚úÖ Seed do Help Center conclu√≠do com sucesso!');
    console.log(`üìä Criados:`);
    console.log(`   - ${applications.length} aplica√ß√µes`);
    console.log(`   - 5 temas`);
    console.log(`   - ${videoData.length} v√≠deos`);
    console.log(`   - ${searchTerms.length} buscas de exemplo`);
  } catch (error) {
    console.error('‚ùå Erro ao executar seed do Help Center:', error);
    throw error;
  } finally {
    await prisma.$disconnect();
  }
}

// Executar o seed se o arquivo for chamado diretamente
if (require.main === module) {
  seedHelpCenter()
    .then(() => {
      console.log('üéâ Seed executado com sucesso!');
      process.exit(0);
    })
    .catch(error => {
      console.error('üí• Erro ao executar seed:', error);
      process.exit(1);
    });
}

export { seedHelpCenter };
