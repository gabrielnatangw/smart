<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Monitor de Sensor - Socket.IO</title>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: Arial, sans-serif; background: #f0f2f5; padding: 20px; }
        .container { max-width: 1200px; margin: 0 auto; }
        .header { text-align: center; margin-bottom: 30px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .header h1 { font-size: 2.5rem; color: #333; margin-bottom: 10px; }
        .header p { font-size: 1.1rem; color: #666; }
        .card { background: white; border-radius: 10px; padding: 25px; margin-bottom: 25px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .status-section { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 20px; }
        .status-info { display: flex; align-items: center; gap: 15px; }
        .status-indicator { width: 20px; height: 20px; border-radius: 50%; background: #ccc; transition: all 0.3s ease; }
        .status-indicator.connected { background: #4CAF50; box-shadow: 0 0 20px #4CAF50; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .status-text { font-size: 1.2rem; font-weight: 600; color: #333; }
        .status-text.connected { color: #4CAF50; }
        .button { padding: 12px 24px; border: none; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s ease; }
        .button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .btn-connect { background: #4CAF50; color: white; }
        .btn-connect:hover { background: #45a049; }
        .btn-disconnect { background: #f44336; color: white; }
        .btn-disconnect:hover { background: #da190b; }
        .btn-send { background: #2196F3; color: white; }
        .btn-send:hover { background: #1976D2; }
        .btn-send:disabled { background: #ccc; cursor: not-allowed; transform: none; }
        .error-display { margin-top: 20px; padding: 15px; background: #ffebee; border: 1px solid #f44336; border-radius: 8px; color: #c62828; display: none; }
        .controls-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 20px; }
        .control-group { display: flex; flex-direction: column; }
        .control-group label { font-weight: 600; color: #333; margin-bottom: 8px; }
        .control-group select, .control-group input { padding: 12px; border: 2px solid #e0e0e0; border-radius: 8px; font-size: 1rem; }
        .control-group select:focus, .control-group input:focus { outline: none; border-color: #2196F3; }
        .data-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; }
        @media (max-width: 768px) { .data-grid { grid-template-columns: 1fr; } .status-section { flex-direction: column; align-items: stretch; } }
        .data-section h2 { color: #333; margin-bottom: 20px; font-size: 1.3rem; }
        .real-time-display { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; text-align: center; min-height: 200px; display: flex; align-items: center; justify-content: center; }
        .real-time-value { font-size: 3rem; font-weight: bold; margin-bottom: 10px; }
        .real-time-unit { font-size: 1.2rem; opacity: 0.9; margin-bottom: 20px; }
        .real-time-details { font-size: 0.9rem; opacity: 0.8; }
        .history-list { max-height: 300px; overflow-y: auto; border: 1px solid #e0e0e0; border-radius: 8px; padding: 10px; }
        .history-item { padding: 15px; background: #f8f9fa; border-radius: 8px; margin-bottom: 10px; border-left: 4px solid #2196F3; transition: all 0.3s ease; }
        .history-item:hover { background: #e3f2fd; transform: translateX(5px); }
        .history-value { font-weight: 600; color: #333; font-size: 1.1rem; }
        .history-time { color: #666; font-size: 0.9rem; margin-top: 5px; }
        .history-id { color: #999; font-size: 0.8rem; margin-top: 5px; }
        .connection-info { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; }
        .info-item { display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid #e0e0e0; }
        .info-label { font-weight: 600; color: #333; }
        .info-value { color: #666; }
        .success-message { position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.3); z-index: 1000; }
        .waiting-message { text-align: center; color: #666; padding: 40px 20px; font-style: italic; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîå Monitor de Sensor</h1>
            <p>Monitoramento em tempo real via Socket.IO</p>
        </div>

        <div class="card">
            <div class="status-section">
                <div class="status-info">
                    <div id="status-indicator" class="status-indicator"></div>
                    <span id="status-text" class="status-text">Desconectado</span>
                </div>
                <div>
                    <button id="connect-btn" class="button btn-connect">Conectar</button>
                    <button id="disconnect-btn" class="button btn-disconnect" style="display: none;">Desconectar</button>
                </div>
            </div>
            <div id="error-display" class="error-display">
                <p id="error-text"></p>
            </div>
        </div>

        <div class="card">
            <h2>üéõÔ∏è Controles do Sensor</h2>
            <div class="controls-grid">
                <div class="control-group">
                    <label for="action-select">A√ß√£o</label>
                    <select id="action-select">
                        <option value="start">Iniciar</option>
                        <option value="stop">Parar</option>
                        <option value="pause">Pausar</option>
                        <option value="reset">Resetar</option>
                    </select>
                </div>
                <div class="control-group">
                    <label for="frequency-input">Frequ√™ncia (ms)</label>
                    <input type="number" id="frequency-input" value="1000" min="100" max="10000" step="100">
                </div>
                <div class="control-group">
                    <label for="threshold-input">Threshold</label>
                    <input type="number" id="threshold-input" value="50" min="0" max="100" step="5">
                </div>
            </div>
            <button id="send-command-btn" class="button btn-send" disabled>Enviar Comando</button>
        </div>

        <div class="data-grid">
            <div class="card">
                <h2>üìä Dados em Tempo Real</h2>
                <div id="real-time-data" class="real-time-display">
                    <div class="waiting-message">Aguardando dados do sensor...</div>
                </div>
            </div>

            <div class="card">
                <h2>üìà Hist√≥rico</h2>
                <div id="data-history" class="history-list">
                    <div class="waiting-message">Nenhum dado recebido ainda</div>
                </div>
            </div>
        </div>

        <div class="card">
            <h2>üîó Informa√ß√µes da Conex√£o</h2>
            <div class="connection-info">
                <div class="info-item">
                    <span class="info-label">URL:</span>
                    <span id="connection-url" class="info-value">http://localhost:3001/sensor</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Status:</span>
                    <span id="connection-status" class="info-value">Desconectado</span>
                </div>
                <div class="info-item">
                    <span class="info-label">√öltima Atualiza√ß√£o:</span>
                    <span id="last-update" class="info-value">-</span>
                </div>
                <div class="info-item">
                    <span class="info-label">Total de Dados:</span>
                    <span id="total-data" class="info-value">0</span>
                </div>
            </div>
        </div>
    </div>

    <script>
        class SensorMonitor {
            constructor() {
                this.socket = null;
                this.isConnected = false;
                this.dataHistory = [];
                this.maxHistoryItems = 50;
                this.connectionUrl = 'http://localhost:3001/sensor';
                this.initializeElements();
                this.bindEvents();
                this.updateConnectionInfo();
            }

            initializeElements() {
                this.statusIndicator = document.getElementById('status-indicator');
                this.statusText = document.getElementById('status-text');
                this.connectBtn = document.getElementById('connect-btn');
                this.disconnectBtn = document.getElementById('disconnect-btn');
                this.errorDisplay = document.getElementById('error-display');
                this.errorText = document.getElementById('error-text');
                this.actionSelect = document.getElementById('action-select');
                this.frequencyInput = document.getElementById('frequency-input');
                this.thresholdInput = document.getElementById('threshold-input');
                this.sendCommandBtn = document.getElementById('send-command-btn');
                this.realTimeData = document.getElementById('real-time-data');
                this.dataHistory = document.getElementById('data-history');
                this.connectionUrlSpan = document.getElementById('connection-url');
                this.connectionStatusSpan = document.getElementById('connection-status');
                this.lastUpdateSpan = document.getElementById('last-update');
                this.totalDataSpan = document.getElementById('total-data');
            }

            bindEvents() {
                this.connectBtn.addEventListener('click', () => this.connect());
                this.disconnectBtn.addEventListener('click', () => this.disconnect());
                this.sendCommandBtn.addEventListener('click', () => this.sendCommand());
                this.frequencyInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') this.sendCommand(); });
                this.thresholdInput.addEventListener('keypress', (e) => { if (e.key === 'Enter') this.sendCommand(); });
            }

            connect() {
                if (this.isConnected) return;
                try {
                    this.socket = io(this.connectionUrl, { reconnection: true, reconnectionDelay: 1000, reconnectionAttempts: 5, timeout: 20000 });
                    this.setupSocketEvents();
                    this.updateConnectionInfo();
                } catch (error) {
                    this.showError(`Erro ao conectar: ${error.message}`);
                }
            }

            disconnect() {
                if (this.socket) { this.socket.disconnect(); this.socket = null; }
                this.setConnectionStatus(false);
                this.updateConnectionInfo();
            }

            setupSocketEvents() {
                this.socket.on('connect', () => { this.setConnectionStatus(true); this.hideError(); this.updateConnectionInfo(); console.log('Conectado ao sensor socket'); });
                this.socket.on('disconnect', () => { this.setConnectionStatus(false); this.updateConnectionInfo(); console.log('Desconectado do sensor socket'); });
                this.socket.on('sensor-data', (data) => { this.handleSensorData(data); });
                this.socket.on('error', (error) => { this.showError(`Erro no socket: ${error.message}`); });
                this.socket.on('connect_error', (error) => { this.showError(`Erro de conex√£o: ${error.message}`); });
            }

            setConnectionStatus(connected) {
                this.isConnected = connected;
                if (connected) {
                    this.statusIndicator.classList.add('connected');
                    this.statusText.textContent = 'Conectado';
                    this.statusText.classList.add('connected');
                    this.connectBtn.style.display = 'none';
                    this.disconnectBtn.style.display = 'inline-block';
                    this.sendCommandBtn.disabled = false;
                } else {
                    this.statusIndicator.classList.remove('connected');
                    this.statusText.textContent = 'Desconectado';
                    this.statusText.classList.remove('connected');
                    this.connectBtn.style.display = 'inline-block';
                    this.disconnectBtn.style.display = 'none';
                    this.sendCommandBtn.disabled = true;
                }
            }

            handleSensorData(data) {
                const timestamp = new Date();
                const dataItem = { ...data, timestamp: timestamp, id: `data-${Date.now()}-${Math.random().toString(36).substr(2, 9)}` };
                this.dataHistory.unshift(dataItem);
                if (this.dataHistory.length > this.maxHistoryItems) { this.dataHistory.pop(); }
                this.updateRealTimeData(dataItem);
                this.updateDataHistory();
                this.updateConnectionInfo();
            }

            updateRealTimeData(data) {
                this.realTimeData.innerHTML = `
                    <div>
                        <div class="real-time-value">${data.value || 'N/A'}</div>
                        <div class="real-time-unit">${data.unit || 'unidade'}</div>
                        <div class="real-time-details">
                            <div>ID: ${data.id || 'N/A'}</div>
                            <div>Timestamp: ${data.timestamp.toLocaleTimeString()}</div>
                        </div>
                    </div>
                `;
            }

            updateDataHistory() {
                if (this.dataHistory.length === 0) {
                    this.dataHistory.innerHTML = '<div class="waiting-message">Nenhum dado recebido ainda</div>';
                    return;
                }
                this.dataHistory.innerHTML = this.dataHistory.map(item => `
                    <div class="history-item">
                        <div class="history-value">${item.value || 'N/A'} ${item.unit || ''}</div>
                        <div class="history-time">${item.timestamp.toLocaleTimeString()}</div>
                        <div class="history-id">ID: ${item.id || 'N/A'}</div>
                    </div>
                `).join('');
            }

            sendCommand() {
                if (!this.isConnected || !this.socket) { this.showError('N√£o conectado ao sensor'); return; }
                const command = { action: this.actionSelect.value, frequency: parseInt(this.frequencyInput.value), threshold: parseInt(this.thresholdInput.value) };
                this.socket.emit('sensor-command', command);
                console.log('Comando enviado:', command);
                this.showSuccessMessage('Comando enviado com sucesso!');
            }

            showError(message) {
                this.errorText.textContent = message;
                this.errorDisplay.style.display = 'block';
                setTimeout(() => { this.errorDisplay.style.display = 'none'; }, 5000);
            }

            hideError() { this.errorDisplay.style.display = 'none'; }

            showSuccessMessage(message) {
                const successDiv = document.createElement('div');
                successDiv.className = 'success-message';
                successDiv.textContent = message;
                document.body.appendChild(successDiv);
                setTimeout(() => { successDiv.remove(); }, 3000);
            }

            updateConnectionInfo() {
                this.connectionUrlSpan.textContent = this.connectionUrl;
                this.connectionStatusSpan.textContent = this.isConnected ? 'Conectado' : 'Desconectado';
                this.lastUpdateSpan.textContent = this.dataHistory.length > 0 ? this.dataHistory[0].timestamp.toLocaleString() : '-';
                this.totalDataSpan.textContent = this.dataHistory.length;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const monitor = new SensorMonitor();
            window.sensorMonitor = monitor;
        });
    </script>
</body>
</html>
