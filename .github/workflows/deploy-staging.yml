name: Deploy to Staging

on:
  push:
    branches:
      - develop
  workflow_run:
    workflows: ['Build and Deploy Docker Image']
    types: [completed]
    branches: [develop]

jobs:
  deploy-staging:
    if: ${{ github.ref == 'refs/heads/develop' && github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
      - name: Deploy para Staging
        run: |
          echo "ğŸš€ Deployando para STAGING..."
          echo "ğŸ“¦ Imagem: ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:develop"
          echo "ğŸŒ Ambiente: Staging"
          echo "ğŸ“¦ Container: smart-v2-backend-staging"
          echo "ğŸŒ Portas: 3000-3001:3000-3001"
          echo ""
          echo "ğŸ“‹ Comando de deploy:"
          echo "docker run -d \\"
          echo "  --name smart-v2-backend-staging \\"
          echo "  -p 3000-3001:3000-3001 \\"
          echo "  --restart unless-stopped \\"
          echo "  -e NODE_ENV=staging \\"
          echo "  -e USE_CLOUD_SQL=true \\"
          echo "  -e INSTANCE_CONNECTION_NAME=smart-201703:us-central1:smart-platform \\"
          echo "  -e PROD_DB_DATABASE=smart-develop \\"
          echo "  ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:develop"
          echo ""
          echo "âœ… Deploy configurado para STAGING!"

      - name: Notificar Deploy
        run: |
          echo "ğŸ“¢ NotificaÃ§Ã£o de Deploy Staging"
          echo "ğŸ• Timestamp: $(date)"
          echo "ğŸ”— Commit: ${{ github.sha }}"
          echo "ğŸ‘¤ Autor: ${{ github.actor }}"
          echo "ğŸŒ¿ Branch: develop"
