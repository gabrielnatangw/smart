name: Deploy to Production

on:
  push:
    branches:
      - main
  workflow_run:
    workflows: ['Build and Deploy Docker Image']
    types: [completed]
    branches: [main]

jobs:
  deploy-production:
    if: ${{ github.ref == 'refs/heads/main' && github.event.workflow_run.conclusion == 'success' }}
    runs-on: ubuntu-latest

    steps:
      - name: Deploy para ProduÃ§Ã£o
        run: |
          echo "ğŸš€ Deployando para PRODUÃ‡ÃƒO..."
          echo "ğŸ“¦ Imagem: ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:main"
          echo "ğŸŒ Ambiente: ProduÃ§Ã£o"
          echo "ğŸ“¦ Container: smart-v2-backend-prod"
          echo "ğŸŒ Portas: 3000-3001:3000-3001"
          echo ""
          echo "ğŸ“‹ Comando de deploy:"
          echo "docker run -d \\"
          echo "  --name smart-v2-backend-prod \\"
          echo "  -p 3000-3001:3000-3001 \\"
          echo "  --restart unless-stopped \\"
          echo "  -e NODE_ENV=production \\"
          echo "  -e USE_CLOUD_SQL=true \\"
          echo "  -e INSTANCE_CONNECTION_NAME=smart-201703:us-central1:smart-platform \\"
          echo "  -e PROD_DB_DATABASE=smart-prod \\"
          echo "  ghcr.io/${{ github.repository_owner }}/${{ github.event.repository.name }}:main"
          echo ""
          echo "âœ… Deploy configurado para PRODUÃ‡ÃƒO!"

      - name: Notificar Deploy
        run: |
          echo "ğŸ“¢ NotificaÃ§Ã£o de Deploy ProduÃ§Ã£o"
          echo "ğŸ• Timestamp: $(date)"
          echo "ğŸ”— Commit: ${{ github.sha }}"
          echo "ğŸ‘¤ Autor: ${{ github.actor }}"
          echo "ğŸŒ¿ Branch: main"
